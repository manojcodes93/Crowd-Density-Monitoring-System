<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Crowd Monitoring Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- External CSS -->
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="container">

    <aside class="sidebar">
        <div class="logo">CrowdAI</div>
    </aside>

    <main class="main">

        <div class="topbar">
            <h1>AI Crowd Monitoring</h1>
            <div class="status online">● System Online</div>
        </div>

        <!-- ALERT -->
        <div id="alertBox"></div>

        <!-- STATS -->
        <div class="stats">
            <div class="card">
                <h2 id="totalCount">0</h2>
                <p>Total Crowd</p>
            </div>

            <div class="card">
                <h2 id="zoneA">0</h2>
                <p>Zone A</p>
            </div>

            <div class="card">
                <h2 id="zoneB">0</h2>
                <p>Zone B</p>
            </div>

            <div class="card">
                <h2 id="zoneC">0</h2>
                <p>Zone C</p>
            </div>

            <div class="card">
                <h2 id="zoneD">0</h2>
                <p>Zone D</p>
            </div>
        </div>

        <!-- HEATMAP -->
        <div class="heatmap-section">
            <div class="heatmap-box">
                <img src="/video" width="100%" height="100%">
            </div>

            <div class="prediction-box">
                <h3>Prediction (Next 5s)</h3>
                <div class="highlight" id="predictionValue">0</div>
            </div>
        </div>

    </main>

</div>

<script>
async function fetchStats() {
    try {
        const response = await fetch("/stats");
        const data = await response.json();

        document.getElementById("totalCount").innerText = data.total;
        document.getElementById("zoneA").innerText = data.zoneA;
        document.getElementById("zoneB").innerText = data.zoneB;
        document.getElementById("zoneC").innerText = data.zoneC;
        document.getElementById("zoneD").innerText = data.zoneD;
        document.getElementById("predictionValue").innerText = data.prediction;

        const alertBox = document.getElementById("alertBox");

        if (data.alert) {
            alertBox.innerHTML = `<div class="alert danger">
                ⚠ Overcrowding Predicted!
            </div>`;
        } else {
            alertBox.innerHTML = "";
        }

    } catch (error) {
        console.log("API not reachable");
    }
}

setInterval(fetchStats, 1000);
fetchStats();
</script>

</body>
</html>